-- Toggle switch with smooth rotation + beam and circle visual

-- Create GUI
local ScreenGui = Instance.new("ScreenGui", game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui"))
local ToggleButton = Instance.new("ImageButton")
ToggleButton.Size = UDim2.new(0, 100, 0, 100)
ToggleButton.Position = UDim2.new(0, 20, 0, 200)
ToggleButton.BackgroundTransparency = 1
ToggleButton.Image = "rbxassetid://105490232180240"
ToggleButton.Parent = ScreenGui

-- Variables
local toggleOn = false
local RunService = game:GetService("RunService")
local player = game.Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")

-- Create beam
local beamPart = Instance.new("Part")
beamPart.Anchored = true
beamPart.CanCollide = false
beamPart.Color = Color3.fromRGB(255,0,0)
beamPart.Material = Enum.Material.Neon
beamPart.Size = Vector3.new(0.3, 0.3, 0.3) -- thicker beam
beamPart.Parent = workspace

local beam = Instance.new("Beam")
beam.Color = ColorSequence.new(Color3.fromRGB(255,0,0))
beam.Width0 = 0.3
beam.Width1 = 0.3
beam.FaceCamera = true
beam.Parent = beamPart

local a0 = Instance.new("Attachment", beamPart)
local a1 = Instance.new("Attachment", workspace.Terrain)
beam.Attachment0 = a0
beam.Attachment1 = a1

-- Create circle
local circlePart = Instance.new("Part")
circlePart.Anchored = true
circlePart.CanCollide = false
circlePart.Size = Vector3.new(5,0.1,5)
circlePart.Color = Color3.fromRGB(255,0,0)
circlePart.Material = Enum.Material.Neon
circlePart.Transparency = 0.5
circlePart.Shape = Enum.PartType.Cylinder
circlePart.Orientation = Vector3.new(0,0,90)
circlePart.Parent = workspace

-- Toggle function
local function setToggle(state)
    toggleOn = state
    -- Smooth rotation animation
    local goalRotation = toggleOn and 180 or 0
    local step = toggleOn and 10 or -10
    for i = ToggleButton.Rotation, goalRotation, step do
        ToggleButton.Rotation = i
        task.wait(0.01)
    end
end

-- Update visuals
RunService.RenderStepped:Connect(function()
    if toggleOn then
        local origin = hrp.Position + hrp.CFrame.LookVector * 2
        local direction = hrp.CFrame.LookVector * 500
        local ray = RaycastParams.new()
        ray.FilterDescendantsInstances = {char}
        ray.FilterType = Enum.RaycastFilterType.Blacklist

        local result = workspace:Raycast(origin, direction, ray)
        if result then
            a0.WorldPosition = origin
            a1.WorldPosition = result.Position
            beam.Enabled = true

            circlePart.Position = result.Position + Vector3.new(0,0.05,0)
            circlePart.Transparency = 0.5
        else
            beam.Enabled = false
            circlePart.Transparency = 1
        end
    else
        beam.Enabled = false
        circlePart.Transparency = 1
    end
end)

-- Click toggle
ToggleButton.MouseButton1Click:Connect(function()
    setToggle(not toggleOn)
end)
